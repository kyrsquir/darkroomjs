!function(){"use strict";var element=document.createElement("div");element["class"]="darkroom-icons",element.style.height=0,element.style.width=0,element.style.position="absolute",element.style.visibility="hidden",element.innerHTML='<!-- inject:svg --><svg xmlns="http://www.w3.org/2000/svg"><symbol id="close" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/><path d="M0 0h24v24H0z" fill="none"/></symbol><symbol id="crop" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M17 15h2V7c0-1.1-.9-2-2-2H9v2h8v8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2H7z"/></symbol><symbol id="done" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></symbol><symbol id="download" viewBox="0 0 550 550"><path d="M445.25 203h-102V50h-153v153h-102l178.5 178.5L445.25 203zm-357 229.5v51h357v-51h-357z"/></symbol><symbol id="edit" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></symbol><symbol id="redo" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z"/></symbol><symbol id="rotate-left" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.11 8.53L5.7 7.11C4.8 8.27 4.24 9.61 4.07 11h2.02c.14-.87.49-1.72 1.02-2.47zM6.09 13H4.07c.17 1.39.72 2.73 1.62 3.89l1.41-1.42c-.52-.75-.87-1.59-1.01-2.47zm1.01 5.32c1.16.9 2.51 1.44 3.9 1.61V17.9c-.87-.15-1.71-.49-2.46-1.03L7.1 18.32zM13 4.07V1L8.45 5.55 13 10V6.09c2.84.48 5 2.94 5 5.91s-2.16 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93s-3.05-7.44-7-7.93z"/></symbol><symbol id="rotate-right" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M15.55 5.55L11 1v3.07C7.06 4.56 4 7.92 4 12s3.05 7.44 7 7.93v-2.02c-2.84-.48-5-2.94-5-5.91s2.16-5.43 5-5.91V10l4.55-4.45zM19.93 11c-.17-1.39-.72-2.73-1.62-3.89l-1.42 1.42c.54.75.88 1.6 1.02 2.47h2.02zM13 17.9v2.02c1.39-.17 2.74-.71 3.9-1.61l-1.44-1.44c-.75.54-1.59.89-2.46 1.03zm3.89-2.42l1.42 1.41c.9-1.16 1.45-2.5 1.62-3.89h-2.02c-.14.87-.48 1.72-1.02 2.48z"/></symbol><symbol id="save" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></symbol><symbol id="undo" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"/></symbol></svg><!-- endinject -->',document.body.appendChild(element)}(),function(){"use strict";function Darkroom(element,options,plugins){return this.constructor(element,options,plugins)}window.Darkroom=Darkroom,Darkroom.plugins=[],Darkroom.prototype={containerElement:null,canvas:null,image:null,sourceCanvas:null,sourceImage:null,originalImageElement:null,transformations:[],defaults:{minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,ratio:null,backgroundColor:"#fff",plugins:{},initialize:function(){}},plugins:{},options:{},constructor:function(element,options,plugins){if(this.options=Darkroom.Utils.extend(options,this.defaults),"string"==typeof element&&(element=document.querySelector(element)),null!==element){var image=new Image;image.onload=function(){this._initializeDOM(element),this._initializeImage(),this._initializePlugins(Darkroom.plugins),this.refresh(function(){this.options.initialize.bind(this).call()}.bind(this))}.bind(this),image.src=element.src}},download:function(){var $container=$(this.containerElement),header=$container.parent().data("header"),fileName=$container.parent().data("fileName");this.canvas.lowerCanvasEl.toBlob(function(modifiedImage){var blob=new Blob([header,loadImage.blobSlice.call(modifiedImage,20)],{type:modifiedImage.type}),a=document.createElement("a"),url=window.URL.createObjectURL(blob);document.body.appendChild(a),a.href=url,a.download="modified-"+fileName.substring(0,fileName.indexOf("."))+".jpg",a.click(),window.URL.revokeObjectURL(url)},"image/jpeg")},crop:function(options){var cropped=new Image,canvas=this.canvas,canvasWidth=canvas.getWidth(),canvasHeight=canvas.getHeight(),canvasEl=canvas.lowerCanvasEl,zoom=(canvasEl.getContext("2d"),canvas.viewport.zoom),left=options.left+canvasWidth/zoom/2,top=options.top+canvasHeight/zoom,width=options.width*zoom,height=options.height*zoom;cropped.src=this.canvas.toDataURL({left:left,top:top,width:width,height:height}),console.log(cropped.src,left,top,width,height,zoom)},addEventListener:function(eventName,callback){var el=this.canvas.getElement();el.addEventListener?el.addEventListener(eventName,callback):el.attachEvent&&el.attachEvent("on"+eventName,callback)},dispatchEvent:function(eventName){var event=document.createEvent("Event");event.initEvent(eventName,!0,!0),this.canvas.getElement().dispatchEvent(event)},refresh:function(next){var clone=new Image;clone.onload=function(){this._replaceCurrentImage(new fabric.Image(clone)),next&&next()}.bind(this),clone.src=this.sourceImage.toDataURL()},_replaceCurrentImage:function(newImage){this.image&&this.image.remove(),this.image=newImage,this.image.selectable=!1;var viewport=Darkroom.Utils.computeImageViewPort(this.image),canvasWidth=viewport.width,canvasHeight=viewport.height;if(null!==this.options.ratio){var canvasRatio=+this.options.ratio,currentRatio=canvasWidth/canvasHeight;currentRatio>canvasRatio?canvasHeight=canvasWidth/canvasRatio:canvasRatio>currentRatio&&(canvasWidth=canvasHeight*canvasRatio)}var scaleMin=1,scaleMax=1,scaleX=1,scaleY=1;null!==this.options.maxWidth&&this.options.maxWidth<canvasWidth&&(scaleX=this.options.maxWidth/canvasWidth),null!==this.options.maxHeight&&this.options.maxHeight<canvasHeight&&(scaleY=this.options.maxHeight/canvasHeight),scaleMin=Math.min(scaleX,scaleY),scaleX=1,scaleY=1,null!==this.options.minWidth&&this.options.minWidth>canvasWidth&&(scaleX=this.options.minWidth/canvasWidth),null!==this.options.minHeight&&this.options.minHeight>canvasHeight&&(scaleY=this.options.minHeight/canvasHeight),scaleMax=Math.max(scaleX,scaleY);var scale=scaleMax*scaleMin;canvasWidth*=scale,canvasHeight*=scale,this.image.setScaleX(1*scale),this.image.setScaleY(1*scale),this.canvas.add(this.image),this.canvas.setWidth(canvasWidth),this.canvas.setHeight(canvasHeight),this.canvas.centerObject(this.image),this.image.setCoords()},applyTransformation:function(transformation){this.transformations.push(transformation),transformation.applyTransformation(this.sourceCanvas,this.sourceImage,this._postTransformation.bind(this))},_postTransformation:function(newImage){newImage&&(this.sourceImage=newImage),this.refresh(function(){this.dispatchEvent("core:transformation")}.bind(this))},reinitializeImage:function(){this.sourceImage.remove(),this._initializeImage(),this._popTransformation(this.transformations.slice())},_popTransformation:function(transformations){if(0===transformations.length)return this.dispatchEvent("core:reinitialized"),void this.refresh();var transformation=transformations.shift(),next=function(newImage){newImage&&(this.sourceImage=newImage),this._popTransformation(transformations)};transformation.applyTransformation(this.sourceCanvas,this.sourceImage,next.bind(this))},_initializeDOM:function(imageElement){var mainContainerElement=document.createElement("div");mainContainerElement.className="darkroom-container";var toolbarElement=document.createElement("div");toolbarElement.className="darkroom-toolbar",mainContainerElement.appendChild(toolbarElement);var canvasContainerElement=document.createElement("div");canvasContainerElement.className="darkroom-image-container";var canvasElement=document.createElement("canvas");canvasContainerElement.appendChild(canvasElement),mainContainerElement.appendChild(canvasContainerElement);var sourceCanvasContainerElement=document.createElement("div");sourceCanvasContainerElement.className="darkroom-source-container",sourceCanvasContainerElement.style.display="none";var sourceCanvasElement=document.createElement("canvas");sourceCanvasContainerElement.appendChild(sourceCanvasElement),mainContainerElement.appendChild(sourceCanvasContainerElement),imageElement.parentNode.replaceChild(mainContainerElement,imageElement),imageElement.style.display="none",mainContainerElement.appendChild(imageElement),this.containerElement=mainContainerElement,this.originalImageElement=imageElement,this.toolbar=new Darkroom.UI.Toolbar(toolbarElement),this.canvas=new fabric.CanvasWithViewport(canvasElement,{selection:!1,backgroundColor:this.options.backgroundColor}),this.sourceCanvas=new fabric.CanvasWithViewport(sourceCanvasElement,{selection:!1,backgroundColor:this.options.backgroundColor})},_initializeImage:function(){this.sourceImage=new fabric.Image(this.originalImageElement,{selectable:!1,evented:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1}),this.sourceCanvas.add(this.sourceImage);var viewport=Darkroom.Utils.computeImageViewPort(this.sourceImage),canvasWidth=viewport.width,canvasHeight=viewport.height;this.sourceCanvas.setWidth(canvasWidth),this.sourceCanvas.setHeight(canvasHeight),this.sourceCanvas.centerObject(this.sourceImage),this.sourceImage.setCoords()},_initializePlugins:function(plugins){for(var name in plugins){var plugin=plugins[name],options=this.options.plugins[name];options!==!1&&plugins.hasOwnProperty(name)&&(this.plugins[name]=new plugin(this,options))}}}}(),function(){var drawControls,old,_drawControl,_setCornerCoords,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};_drawControl=fabric.Object.prototype._drawControl,fabric.Object.prototype._drawControl=function(control,ctx,methodName,left,top){var zoom,_ref;return zoom=(null!=(_ref=this.canvas.viewport)?_ref.zoom:void 0)||1,ctx.lineWidth=1/Math.max(this.scaleX,this.scaleY)/zoom,_drawControl.apply(this,[control,ctx,methodName,left,top])},drawControls=fabric.Object.prototype.drawControls,fabric.Object.prototype.drawControls=function(ctx){var ret,zoom,_ref,_ref1;return zoom=(null!=(_ref=this.canvas)&&null!=(_ref1=_ref.viewport)?_ref1.zoom:void 0)||1,this.cornerSize=this.cornerSize/zoom,ret=drawControls.apply(this,[ctx]),this.cornerSize=this.cornerSize*zoom,ret},_setCornerCoords=fabric.Object.prototype._setCornerCoords,fabric.Object.prototype._setCornerCoords=function(){var ret,zoom,_ref,_ref1;return zoom=(null!=(_ref=this.canvas)&&null!=(_ref1=_ref.viewport)?_ref1.zoom:void 0)||1,this.cornerSize=this.cornerSize/zoom,ret=_setCornerCoords.apply(this),this.cornerSize=this.cornerSize*zoom,ret},fabric.Object.prototype.drawBorders=function(ctx){var h,padding,padding2,rotateHeight,scaleX,scaleY,strokeWidth,w,zoom,_ref,_ref1;return this.hasBorders?(zoom=(null!=(_ref=this.canvas)&&null!=(_ref1=_ref.viewport)?_ref1.zoom:void 0)||1,padding=this.padding,padding2=2*padding,strokeWidth=2*~~(this.strokeWidth/2),ctx.save(),ctx.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,ctx.strokeStyle=this.borderColor,scaleX=1/this._constrainScale(this.scaleX),scaleY=1/this._constrainScale(this.scaleY),ctx.lineWidth=1/this.borderScaleFactor/zoom,ctx.scale(scaleX,scaleY),w=this.getWidth(),h=this.getHeight(),ctx.strokeRect(-(w/2)-padding-strokeWidth/2*this.scaleX-.5/zoom,-(h/2)-padding-strokeWidth/2*this.scaleY-.5/zoom,w+padding2+strokeWidth*this.scaleX+1/zoom,h+padding2+strokeWidth*this.scaleY+1/zoom),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(rotateHeight=(this.flipY?h+(strokeWidth*this.scaleY+2*padding)*zoom:-h-(strokeWidth*this.scaleY+2*padding)*zoom)/2,ctx.beginPath(),ctx.moveTo(0,rotateHeight),ctx.lineTo(0,rotateHeight+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset)),ctx.closePath(),ctx.stroke()),ctx.restore(),this):this},fabric.Viewport=function(){function Viewport(canvas){this.i=0,this.position=new fabric.Point(0,0),this.zoom=1,this.canvas=canvas,this._resetGrab()}return Viewport.prototype.grabStart=function(e){return this.grabStartPointer=this.canvas.getPointer(e)},Viewport.prototype.grab=function(e){return this.grabPointer=this.canvas.getPointer(e)},Viewport.prototype.grabEnd=function(e){var diff;return diff=new fabric.Point(this.canvas.getPointer(e).x-this.grabStartPointer.x,this.canvas.getPointer(e).y-this.grabStartPointer.y),this.position=this.position.add(diff),this._resetGrab()},Viewport.prototype._resetGrab=function(){return this.grabStartPointer={x:0,y:0},this.grabPointer={x:0,y:0}},Viewport.prototype.setZoom=function(newZoom){return this._adjustPositionAfterZoom(newZoom),this.zoom=newZoom},Viewport.prototype._adjustPositionAfterZoom=function(newZoom){var halfHeight,halfWidth,k;return halfWidth=this.canvas.width/2,halfHeight=this.canvas.height/2,k=newZoom/this.zoom,this.position.x=halfWidth-k*(halfWidth-this.position.x),this.position.y=halfHeight-k*(halfHeight-this.position.y)},Viewport.prototype.translate=function(){return{x:(this.position.x+this.grabPointer.x-this.grabStartPointer.x)/this.zoom,y:(this.position.y+this.grabPointer.y-this.grabStartPointer.y)/this.zoom}},Viewport.prototype.transform=function(event){var ex,touchProp;return touchProp="touchend"===event.type?"changedTouches":"touches",event[touchProp]&&event[touchProp][0]?(ex={},ex[touchProp]=_.map(event[touchProp],function(_this){return function(t){return _this._transformEventParams(t)}}(this)),$.extend($.Event(event.type),ex)):$.extend($.Event(event.type),this._transformEventParams(event))},Viewport.prototype._transformEventParams=function(e){var offsetLeft,offsetTop;return offsetTop=this.canvas.wrapperEl.getBoundingClientRect().top,offsetLeft=this.canvas.wrapperEl.getBoundingClientRect().left,{which:1,clientX:(e.clientX-offsetLeft)/this.zoom+offsetLeft-this.translate().x,clientY:(e.clientY-offsetTop)/this.zoom+offsetTop-this.translate().y,pageX:e.pageX-this.translate().x,pageY:e.pageY-this.translate().y,screenX:e.screenX-this.translate().x,screenY:e.screenY-this.translate().y}},Viewport}(),old=fabric.PencilBrush.prototype._render,fabric.PencilBrush.prototype._render=function(){var ctx;return this.canvas.viewport?(ctx=this.canvas.contextTop,ctx.save(),ctx.scale(this.canvas.viewport.zoom,this.canvas.viewport.zoom),ctx.translate(this.canvas.viewport.translate().x,this.canvas.viewport.translate().y),old.apply(this),ctx.restore()):old.apply(this)},fabric.CanvasWithViewport=function(_super){function CanvasWithViewport(){this.viewport=new fabric.Viewport(this),this.isGrabMode=!1,this._isCurrentlyGrabbing=!1,CanvasWithViewport.__super__.constructor.apply(this,arguments)}return __extends(CanvasWithViewport,_super),CanvasWithViewport.prototype.setZoom=function(zoom){return this.viewport.setZoom(zoom),this.renderAll()},CanvasWithViewport.prototype._onMouseMoveInGrabMode=function(e){return this._isCurrentlyGrabbing?(this.viewport.grab(e),this.renderAll(),!0):void 0},CanvasWithViewport.prototype._onMouseDownInGrabMode=function(e){return this._isCurrentlyGrabbing=!0,this.viewport.grabStart(e)},CanvasWithViewport.prototype._onMouseUpInGrabMode=function(e){return this._isCurrentlyGrabbing&&(this.viewport.grabEnd(e),this._isCurrentlyGrabbing=!1,this.renderAll()),!0},CanvasWithViewport.prototype._draw=function(ctx,object){return ctx.save(),ctx.scale(this.viewport.zoom,this.viewport.zoom),ctx.translate(this.viewport.translate().x,this.viewport.translate().y),CanvasWithViewport.__super__._draw.apply(this,arguments),ctx.restore()},CanvasWithViewport.prototype._drawSelection=function(){var ctx;return ctx=this.contextTop,ctx.save(),ctx.scale(this.viewport.zoom,this.viewport.zoom),ctx.translate(this.viewport.translate().x,this.viewport.translate().y),CanvasWithViewport.__super__._drawSelection.apply(this,arguments),ctx.restore()},CanvasWithViewport.prototype.__onMouseMove=function(e){return this.isGrabMode?void this._onMouseMoveInGrabMode(e):CanvasWithViewport.__super__.__onMouseMove.call(this,this.viewport.transform(e))},CanvasWithViewport.prototype.__onMouseDown=function(e){return this.isGrabMode?void this._onMouseDownInGrabMode(e):CanvasWithViewport.__super__.__onMouseDown.call(this,this.viewport.transform(e))},CanvasWithViewport.prototype.__onMouseUp=function(e){return this.isGrabMode?void this._onMouseUpInGrabMode(e):CanvasWithViewport.__super__.__onMouseUp.call(this,this.viewport.transform(e))},CanvasWithViewport}(fabric.Canvas)}.call(this),function(){"use strict";var $dropzone=$("#dropzone"),$images=$("#images"),$metadata=$("#metadata");window.dkrm=[],$dropzone.on({dragover:function(event){event.preventDefault(),event.stopPropagation(),$dropzone.addClass("hover")},dragleave:function(event){event.preventDefault(),event.stopPropagation(),$dropzone.removeClass("hover")},drop:function(event){event.preventDefault(),event.stopPropagation(),$dropzone.removeClass("hover"),$images.empty(),$metadata.empty(),Array.prototype.forEach.call(event.originalEvent.dataTransfer.files,function(file,index){$images.append('<div class="wrapper" id="'+index+'">                                     <div id="image-container-'+index+'"></div>                                </div>'),$metadata.append('<div id="exif-'+index+'" style="display: none;" class="exif">                                      <table></table>                                  </div>'),$("#image-container-"+index).data("fileName",file.name),loadImage.parseMetaData(file,function(data){var $exif=$("#exif-"+index);if($("#image-container-"+index).data("header",data.imageHead),data.exif){var prop,tags=data.exif.getAll(),table=$exif.find("table"),row=$("<tr></tr>"),cell=$("<td></td>");for(prop in tags)tags.hasOwnProperty(prop)&&table.append(row.clone().append(cell.clone().text(prop)).append(cell.clone().text(tags[prop])))}else $exif.html('<div class="no-metadata">No available metadata</div>');var img=document.createElement("img");img.onload=function(){img.id="target-"+index,$("#image-container-"+index).append(img);var darkroom=new Darkroom("#"+img.id,{minWidth:100,minHeight:100,initialize:function(){var $container=$(this.containerElement).find(".canvas-container");$('<button type="button" class="darkroom-button darkroom-button-default">                                       <svg class="darkroom-icon"><use xlink:href="#edit" /></svg>                                   </button>').click(function(){var $button=$(this),$wrapper=$button.closest(".wrapper"),id=$wrapper.attr("id");$wrapper.draggable("disable"),darkroom.canvas.isGrabMode=!0,$button.hide().parent().parent().siblings(".darkroom-toolbar").addClass("active"),$("#exif-"+id).show().siblings().hide()}).appendTo($container),$container.resizable({resize:function(event,ui){var $canvases=$(this).find(".lower-canvas,.upper-canvas"),img=new Image,ctx=$canvases.filter(".lower-canvas").get(0).getContext("2d");img.onload=function(){$canvases.attr({width:ui.size.width,height:ui.size.height}).css({width:ui.size.width,height:ui.size.height}),ctx.drawImage(img,0,0),darkroom.canvas.setZoom(darkroom.canvas.viewport.zoom)},img.src=darkroom.originalImageElement.src}}),$(".wrapper").draggable({})}});window.dkrm.push(darkroom)},loadImage.readFile(file,function(e){img.src=e.target.result})})})}})}(),function(){"use strict";function Plugin(darkroom,options){this.darkroom=darkroom,this.options=Darkroom.Utils.extend(options,this.defaults),this.initialize()}Darkroom.Plugin=Plugin,Plugin.prototype={defaults:{},initialize:function(){}},Plugin.extend=function(protoProps){var child,parent=this;child=protoProps&&protoProps.hasOwnProperty("constructor")?protoProps.constructor:function(){return parent.apply(this,arguments)},Darkroom.Utils.extend(child,parent);var Surrogate=function(){this.constructor=child};return Surrogate.prototype=parent.prototype,child.prototype=new Surrogate,protoProps&&Darkroom.Utils.extend(child.prototype,protoProps),child.__super__=parent.prototype,child}}(),function(){"use strict";function Transformation(options){this.options=options}Darkroom.Transformation=Transformation,Transformation.prototype={applyTransformation:function(image){}},Transformation.extend=function(protoProps){var child,parent=this;child=protoProps&&protoProps.hasOwnProperty("constructor")?protoProps.constructor:function(){return parent.apply(this,arguments)},Darkroom.Utils.extend(child,parent);var Surrogate=function(){this.constructor=child};return Surrogate.prototype=parent.prototype,child.prototype=new Surrogate,protoProps&&Darkroom.Utils.extend(child.prototype,protoProps),child.__super__=parent.prototype,child}}(),function(){"use strict";function Toolbar(element){this.element=element}function ButtonGroup(element){this.element=element}function Button(element){this.element=element}Darkroom.UI={Toolbar:Toolbar,ButtonGroup:ButtonGroup,Button:Button},Toolbar.prototype={createButtonGroup:function(options){var buttonGroup=document.createElement("div");return buttonGroup.className="darkroom-button-group",this.element.appendChild(buttonGroup),new ButtonGroup(buttonGroup)}},ButtonGroup.prototype={createButton:function(options){var defaults={image:"help",type:"default",group:"default",hide:!1,disabled:!1};options=Darkroom.Utils.extend(options,defaults);var buttonElement=document.createElement("button");buttonElement.type="button",buttonElement.className="darkroom-button darkroom-button-"+options.type,buttonElement.innerHTML='<svg class="darkroom-icon"><use xlink:href="#'+options.image+'" /></svg>',this.element.appendChild(buttonElement);var button=new Button(buttonElement);return button.hide(options.hide),button.disable(options.disabled),button}},Button.prototype={addEventListener:function(eventName,listener){this.element.addEventListener?this.element.addEventListener(eventName,listener):this.element.attachEvent&&this.element.attachEvent("on"+eventName,listener)},removeEventListener:function(eventName,listener){this.element.removeEventListener&&this.element.removeEventListener(eventName,listener)},active:function(value){value?this.element.classList.add("darkroom-button-active"):this.element.classList.remove("darkroom-button-active")},hide:function(value){value?this.element.classList.add("darkroom-button-hidden"):this.element.classList.remove("darkroom-button-hidden")},disable:function(value){this.element.disabled=value?!0:!1}}}(),function(){"use strict";function extend(b,a){var prop;if(void 0===b)return a;for(prop in a)a.hasOwnProperty(prop)&&b.hasOwnProperty(prop)===!1&&(b[prop]=a[prop]);return b}function computeImageViewPort(image){return{height:Math.abs(image.getWidth()*Math.sin(image.getAngle()*Math.PI/180))+Math.abs(image.getHeight()*Math.cos(image.getAngle()*Math.PI/180)),width:Math.abs(image.getHeight()*Math.sin(image.getAngle()*Math.PI/180))+Math.abs(image.getWidth()*Math.cos(image.getAngle()*Math.PI/180))}}Darkroom.Utils={extend:extend,computeImageViewPort:computeImageViewPort}}(),function(){"use strict";Darkroom.plugins.edit=Darkroom.Plugin.extend({defaults:{callback:function(){this.darkroom.canvas.isGrabMode=!1;var $container=$(this.darkroom.containerElement),$wrapper=$container.closest(".wrapper"),id=$wrapper.attr("id");$container.children(".darkroom-toolbar").removeClass("active"),$container.find(".darkroom-button").show(),$wrapper.draggable("enable"),$("#exif-"+id).hide()}},initialize:function(){var buttonGroup=this.darkroom.toolbar.createButtonGroup();this.destroyButton=buttonGroup.createButton({image:"save"}),this.destroyButton.addEventListener("click",this.options.callback.bind(this))}})}(),function(){"use strict";Darkroom.plugins.download=Darkroom.Plugin.extend({defaults:{callback:function(){this.darkroom.download()}},initialize:function(){var buttonGroup=this.darkroom.toolbar.createButtonGroup();this.downloadButton=buttonGroup.createButton({image:"download"}),this.downloadButton.addEventListener("click",this.options.callback.bind(this))}})}(),function(){"use strict";Darkroom.Transformation.extend({applyTransformation:function(canvas,image,next){next()}});Darkroom.plugins.zoom=Darkroom.Plugin.extend({initialize:function(){var darkroom=this.darkroom,canvas=darkroom.canvas,$container=$(darkroom.containerElement);$container.on("mousewheel",function(event){var scrollUp=event.originalEvent.wheelDelta>0;if(event.ctrlKey){event.preventDefault();var lowerCanvasEl=canvas.lowerCanvasEl,upperCanvasEl=canvas.upperCanvasEl,modifier=scrollUp?.9:1.1,width=lowerCanvasEl.width*modifier,height=lowerCanvasEl.height*modifier,img=new Image,ctx=lowerCanvasEl.getContext("2d");img.onload=function(){$(lowerCanvasEl).add(upperCanvasEl).attr({width:width,height:height}).add(lowerCanvasEl.parentNode).css({width:width,height:height}),ctx.drawImage(img,0,0),darkroom.canvas.setZoom(darkroom.canvas.viewport.zoom)},img.src=darkroom.originalImageElement.src}else canvas.isGrabMode===!0&&(event.preventDefault(),scrollUp?canvas.setZoom(1.1*canvas.viewport.zoom):canvas.setZoom(.9*canvas.viewport.zoom))})}})}();